(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[506],{2027:function(e,t,n){Promise.resolve().then(n.bind(n,2540))},2540:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var o=n(7437),r=n(5430),s=n(2752);function i(){return(0,o.jsx)("h2",{children:"欢迎来到界面，点击按钮以连接Supervisor"})}var c=n(9764),l=n(305),a=n(9944),u=n(5171),h=n(5771),d=n(7600);class g{async retryTillConnect(){for(console.log("in retryTillConnect");;)try{console.log("creating websocket"),new a.x;let e=(0,d.j)({url:"ws://localhost:7697"});return console.log("now racing for open"),e}catch(e){console.error("Connection failed"),this.fsm.toFailed()}}async receiveMsgLoop(e){let t=e.asObservable();console.log("in receiveMsgLoop"),t.pipe((0,h.h)(e=>"heartbeat"==e.type));let n=t.pipe((0,h.h)(e=>"heartbeat"!=e.type));for(;;){try{console.log("before receive msg");var o=await (0,u.z)(n);console.log("after receive msg,before fsm.next"),this.fsm.next(o)}catch(e){console.log("ERR happened: ",e),this.fsm.toFailed();return}if("bye"==o.type)return}}async start(){console.log("in start");let e=new WebSocket("ws://localhost:7697/api/status");e.onopen=t=>{console.log("opened"),e.onmessage=e=>{this.fsm.next(JSON.parse(e.data))}},e.onerror=e=>{console.log("error happened"),console.log(e),this.fsm.toFailed()}}constructor(){this.fsm=new f}}var p={type:"no_use",content:null};class f{init(e){return(0,l.z)(()=>{s.i7.val=s.qb.Init}),this.connecting}connecting(e){if(console.log("there is connecting. the m is:"),console.log(e),console.log("the m.type is ".concat(e.type)),"hello"==e.type)return(0,l.z)(()=>{s.i7.val=s.qb.Connected}),this.connected;throw Error()}connected(e){if("started"==e.type)return(0,l.z)(()=>{s.i7.val=s.qb.Running}),this.computing;throw Error()}computing(e){if("computing"==e.type)return(0,l.z)(()=>{s.YD.val=e.content}),this.computing;if("completed"==e.type)return(0,l.z)(()=>{s.i7.val=s.qb.Completed,s.Hj.val=e.content}),this.completed;throw Error()}completed(e){if("bye"==e.type)return this.completed;throw Error()}failed(e){throw Error()}toFailed(){(0,l.z)(()=>{s.i7.val=s.qb.Disconnected}),this.state=this.failed}next(e){console.log("FSM got Msg: ".concat(e)),console.log(e),console.log("FSM state before:"),console.log(this.state);try{this.state=this.state(e)}catch(e){console.log("FSM run into error catched:"),console.log(e)}console.log("FSM state after:"),console.log(this.state)}constructor(){this.state=this.init,this.next(p)}}var m=n(7138);let v=(0,r.Pi)(e=>{let{status:t}=e;return(0,o.jsxs)("div",{children:[(0,o.jsx)(c.ZP,{onClick:()=>{console.log("start the receiver"),new g().start().then(()=>{console.log("Receiver Exit.")})},type:"primary",size:"large",children:t.val==s.qb.Init?"点这里开始计算":t.val==s.qb.Completed?"计算已完成，点击重新运算":"计算中"}),(0,o.jsxs)("h1",{children:["Emulator运行中 状态为",s.qb[t.val]]})]})}),x=(0,r.Pi)(e=>{let{status:t}=e;return(0,o.jsx)("div",{children:(()=>{switch(t.val){case s.qb.Init:return(0,o.jsxs)(o.Fragment,{children:["初始状态 正在连接到Sup服务器。",(0,o.jsx)(i,{})]});case s.qb.Connected:return(0,o.jsx)(o.Fragment,{children:"连接成功 Sup还没开始运行"});case s.qb.ConnectionFailed:return(0,o.jsx)(o.Fragment,{children:"连接失败。请关闭重启。"});case s.qb.Running:return(0,o.jsxs)(o.Fragment,{children:["正在运行中，进度为：","".concat(JSON.stringify(s.YD.val))]});case s.qb.RunningFailed:return(0,o.jsx)(o.Fragment,{children:"运行失败，请关闭重启。"});case s.qb.Completed:return(0,o.jsxs)(o.Fragment,{children:["已完成，报告准备好了，点击",(0,o.jsx)(m.default,{href:"/report",children:"查看报告"}),"。"]});case s.qb.Disconnected:return(0,o.jsx)(o.Fragment,{children:"已退出"});default:return(0,o.jsx)(o.Fragment,{})}})()})});var b=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(v,{status:s.i7}),(0,o.jsx)(x,{status:s.i7})]}),j=n(1894),y=n(7449),F=n.n(y);function C(){return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(F(),{children:(0,o.jsx)("title",{children:"Blockemulator Supervisor Monitor"})}),(0,o.jsx)(m.default,{href:"https://github.com",children:(0,o.jsx)(j.Z,{})}),(0,o.jsx)(b,{}),(0,o.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-between p-24",children:(0,o.jsx)("h1",{children:"2024"})})]})}},2752:function(e,t,n){"use strict";n.d(t,{Hj:function(){return l},YD:function(){return c},i7:function(){return i},qb:function(){return r}});var o,r,s=n(305);(o=r||(r={}))[o.Init=0]="Init",o[o.Connected=1]="Connected",o[o.ConnectionFailed=2]="ConnectionFailed",o[o.Running=3]="Running",o[o.RunningFailed=4]="RunningFailed",o[o.Completed=5]="Completed",o[o.Disconnected=6]="Disconnected";let i=(0,s.ky)({val:0}),c=(0,s.ky)({val:{count:0,total:0}}),l=(0,s.ky)({val:{pbftShardCsv:[],measureOutputs:[]}})}},function(e){e.O(0,[147,364,764,831,562,467,971,23,744],function(){return e(e.s=2027)}),_N_E=e.O()}]);